<!doctype html>
<html>
<head>
  <title>Record Generator</title>
  <style type="text/css" media="screen">
    body {
      width: 600px;
      margin: 0 auto;
    }

    #result {
      width: 100%;
      min-height: 15em;
    }
  </style>
</head>
<body>
<h1>Record Generator</h1>

<p>
  <label for="start_date">Start Date</label><br>
  <input type="date" id="start_date" name="start_date" value="2013-10-01">
  <input type="time" id="start_time" name="start_time" value="00:00"> UTC
</p>

<p>
  <label for="end_date">End Date</label><br>
  <input type="date" id="end_date" name="end_date" value="2013-10-15">
  <input type="time" id="end_time" name="end_time" value="00:00"> UTC
</p>

<p>
  <label for="distribution">Value Distribution</label><br>
  <select name="distribution" id="distribution">
    <option value="uniform">Uniform</option>
    <option value="normal">Normal</option>
  </select>
</p>

<p>Records will be generated at 15 minute intervals.</p>

<button id="generate">Generate</button>

<p>
  <textarea id="result"></textarea>
</p>

<script src="http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0/zepto.min.js" type="text/javascript" charset="utf-8"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/moment.js/2.2.1/moment.min.js" type="text/javascript" charset="utf-8"></script>
<script>
Zepto(function($) {
  $("#generate").on("click", function() {

    function hex(n) {
      n = n || 16;
      var result = '';
      while (n--) {
        result += Math.floor(Math.random() * 16).toString(16);
      }
      return result;
    }

    function rand_uniform(min, max) {
      return Math.floor(Math.random() * (max - min) + min);
    }

    function rand_normal() {
      var V1, V2, S;

      do {
        var U1 = Math.random();
        var U2 = Math.random();
        V1 = 2 * U1 - 1;
        V2 = 2 * U2 - 1;
        S = V1 * V1 + V2 * V2;
      } while (S > 1);

      X = Math.sqrt(-2 * Math.log(S) / S) * V1;
      return X;
    }

    var start = moment.utc($("#start_date").val() + " " + $("#start_time").val());
    var end = moment.utc($("#end_date").val() + " " + $("#end_time").val());

    var dist_func = null;

    switch($("#distribution").val()) {
      case "normal":
      dist_func = function() {
        return rand_normal();
      };
      break;
      case "uniform":
      default:
      dist_func = function() {
        return rand_uniform(0, 10);
      };
    }

    var data = [];

    for (var i = +start; i < +end; i += 15 * 60 * 1000) {
      var time = moment.utc(moment.unix(i / 1000));

      data.push({
        uid: hex(32),
        id: time.format("YYYY-MM-DDTHH:mm:ss"),
        reading: dist_func().toString(),
        dateTime: time.format("ddd MMM D HH:mm:ss UTC YYYY")
      });
    };

    $("#result").val(JSON.stringify(data, null, 2));

  });
});
</script>
</body>
</html>
